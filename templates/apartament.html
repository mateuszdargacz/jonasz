{% extends "base.html" %}
{% load i18n cms_tags menu_tags sekizai_tags thumbnail %}
{% block extra-js %}
    {{ block.super }}
    <script type="text/javascript"
            src="https://maps-api-ssl.google.com/maps/api/js?v=3&sensor=true"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#arival").datepicker({
                dateFormat: "yy-mm-dd",
                showOn: "button",
                buttonImage: "{{ STATIC_URL }}img/kalendarz.png",
                buttonImageOnly: true,
                showAnim: "slideDown"
            });

            $("#comingback").datepicker({
                dateFormat: "yy-mm-dd",
                showOn: "button",
                buttonImage: "{{ STATIC_URL }}img/kalendarz.png",
                buttonImageOnly: true,
                showAnim: "slideDown"
            });
        });

        $(document).ready(function (event) {

            $('body').delegate('.calendar_month_switch', 'click', function (ev) {
                ev.preventDefault();
                $.get($(this).attr('href'), function (data) {
                    $('#calendar_month').html(data);
                });
            })

            // save settings form plugin
            var container = 'google-map-{{ apartament.pk }}';
            var latlng = new google.maps.LatLng(46.94708, 7.445975); // default to switzerland

            var title = "{{ apartament.name }}";
            var address = "{{ apartament.street }},{{ apartament.city }}";

            var options = {
                zoom: 14,
                mapTypeId: google.maps.MapTypeId.ROADMAP /* ROADMAP, SATELLITE, HYBRID or TERRAIN */
            };

            // load latlng from given address
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({'address': address}, function (results, status) {
                // check if address can be found if not show default (var latlng)
                if (status == google.maps.GeocoderStatus.OK) latlng = results[0].geometry.location;
                initGoogleMaps(latlng);
            });

            // initialize google maps
            function initGoogleMaps(latlng) {
                // overwrite options
                options.center = latlng;
                // initialize google map
                var map = new google.maps.Map(document.getElementById(container), options);
                // create marker
                var marker = new google.maps.Marker({
                    'position': options.center,
                    'map': map,
                    'title': title
                });
                // prepare info window
                var infowindow = new google.maps.InfoWindow({
                    content: "<strong>" + title + "</strong> \
                    <br />" + address {% if apartament.name %} + "<br /> \
                    <br /><em>{{ apartament.priceLow }}{% trans "$" %}-{{ apartament.priceHigh }}{% trans "$" %}</em>"{% endif %}
                });
                // show info window
                infowindow.open(map, marker);
            }
        })

    </script>
{% endblock %}
{% block "css" %}
    <link rel="stylesheet"  href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" media="all" href="{{ STATIC_URL }}css/apartament.css">
{% endblock %}

{% block reservation %}
    <div class="container purchase">
    <div class="row">
    <div class="col-md-3 visible-desktop">
        <div class="row-fluid">
            <div class="rezerwacja visible-desktop">
                <div class="text">{% trans "Booking" %}</div>
                <div class="rezerw_content">

                    <form action="/{{ LANGUAGE_CODE|lower }}/apartaments/search"
                          method="GET">
                        <p>{% trans "Arrival" %}</p>
                        <input type="text" name="arrival" id="arival"/>

                        <p>{% trans "Check out" %}</p>
                        <input type="text" name="comingback"
                               id="comingback"/>

                        <p>{% trans "Number of persons" %}</p>
                        <select id="id_persons" name="persons">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4" selected>4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>

                        <div class="arrow"></div>

                        <button type="submit">
                            {% trans "check availability" %}
                        </button>
                    </form>
                </div>
            </div>

        </div>
    </div>
    <div class="col-md-9 apartamenty">


        <div class="panel panel-default">
                        <div class="panel-heading">
                            <h2>
                                <a href="{% url "apartaments:apartament_detail" apartament.slug %}">
                                    <div class="title">{{ apartament.name }}</div>
                                </a>
                            </h2>
                        </div>
                        <div class="panel-body">
                            <div class="subtitle">{{ apartament.subtitle }}</div>
                            <div class="aboutText">{{ apartament.teaserText|truncatechars:121 }}</div>
                            <div class="rooms">
                                <div>{% trans "Rooms" %}: {{ apartament.rooms }}</div>
                                <div>{% trans "Max people" %}: {{ apartament.maxPeople }}</div>
                                <div>
                                    {% trans "Surface" %}: {{ apartament.surface }}
                                    m2
                                </div>
                                {% trans "Prices" %}
                                {% for price in apartament.price.all %}
                                    {{ price.price }}<br>{% endfor %}
                            </div>
                            <a class="pull-right" href="{% url "apartaments:apartament_detail" apartament.slug %}#photos"><img
                                src="{% thumbnail apartament.teaserPicture 271x266 %}"
                                alt=""></a>
                        </div>
                        <div class="panel-footer">
                            <a class="btn btn-buy"
                               href="/{{ LANGUAGE_CODE|lower }}/reservation/?name={{ apartament.pk }}{% if start and end %};start={{ start }};end={{ end }}{% endif %}">
                                <div class="span4 lookup">
                                    {% trans "Book" %}
                                </div>
                            </a>
                        </div>
                        <div class="panel-blue text-center">

                        </div>
                        <div class="panel-grey">
                            {{ apartament.description }}
                        </div>
                   {% for photos in listOfPhotos %}

                    <div class="row panel-grey">
                        {% if photos.template == "1" %}
                            <div class="span12 photos text-center">
                                <img src="{% thumbnail photos.imageField1 970x0 %}">
                            </div>
                        {% endif %}

                        {% if photos.template == "2" %}
                            <div class="span6 photos text-center">
                                <img src="{% thumbnail photos.imageField1 485x0 %}">
                            </div>
                            <div class="span6 photos">
                                <img src="{% thumbnail photos.imageField2 485x0 %}">
                            </div>
                        {% endif %}

                        {% if photos.template == "3" %}
                            <div class="span4 photos text-center">
                                <img src="{% thumbnail photos.imageField1 310x0 %}">
                            </div>
                            <div class="span4 photos text-center">
                                <img src="{% thumbnail photos.imageField2 310x0 %}">
                            </div>
                            <div class="span4 photos text-center">
                                <img src="{% thumbnail photos.imageField3 310x0 %}">
                            </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    <div class="panel-blue">
                        <div id="calendar_month" class="ui-corner-all">
                            {{ calendar|safe }}
                        </div>
                    </div>
                    <div class="panel">
                         <div class="plugin_googlemap">
                            {% if apartament.street %}<h2>{{ apartament.name }}
                                </h2>{% endif %}

                            <div id="google-map-{{ apartament.pk }}"
                                 class="google-map-container"
                                 style="height: 500px;"></div>

                        </div>
                    </div>
            </div>
    </div>

    </div>
{% endblock %}


